<!doctype html><html lang=zh dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content='
文章来源: https://bbs.loongarch.org/d/435-2k500openharmony


  一、系统需求和环境配置
  #

官方推荐系统是ubuntu 20.4，预留60G到80G的磁盘空间，交换分区推荐8G以上，主要环境是python3.9。
也可以使用Debian构建，留意python版本，python3.10及更新版本要改一行代码，才能正常运行hb构建工具。
需要安装的软件包：
sudo apt update
sudo apt upgrade
sudo apt install   apt-utils binutils bison flex bc build-essential make mtd-utils gcc-arm-linux-gnueabi u-boot-tools python3.9 python3-pip git zip unzip curl wget gcc g++ ruby dosfstools mtools default-jre default-jdk scons python3-distutils perl openssl libssl-dev cpio git-lfs m4 ccache zlib1g-dev tar rsync liblz4-tool genext2fs binutils-dev device-tree-compiler e2fsprogs git-core gnupg gnutls-bin gperf lib32ncurses5-dev libffi-dev zlib* libelf-dev libx11-dev libgl1-mesa-dev lib32z1-dev xsltproc x11proto-core-dev libc6-dev-i386 libxml2-dev lib32z-dev libdwarf-dev grsync xxd libglib2.0-dev libpixman-1-dev kmod jfsutils reiserfsprogs xfsprogs squashfs-tools  pcmciautils quota ppp libtinfo-dev libtinfo5 libncurses5 libncurses5-dev libncursesw5 libstdc++6  gcc-arm-none-eabi vim ssh locales doxygen libxinerama-dev libxcursor-dev libxrandr-dev libxi-dev npm libfl-dev

  二、注册gitee账号和代码下载前的准备
  #

源码下载推荐使用gitee的repo工具，从OpenHarmony gitee仓库下载代码，也可以使用OpenHarmony全量代码包。
参见资源链接1。使用repo工具需要gitee账号，并上传ssh公钥到账号的"ssh配置”里面，并且需要对git进行全局配置。大致过程如下：
1、使用电子邮箱注册gitee账号，如 
  abc@163.com
2、使用如下命令建立公钥
ssh-keygen -t ed25519 -C "Gitee SSH Key"
3、获取公钥内容并复制到gitee的ssh配置里面
cat ~/.ssh/id_ed25519.pub
4、获取gitee repo工具并赋予可执行权限
sudo curl -s https://gitee.com/oschina/repo/raw/fork_flow/repo-py3 > /usr/local/bin/repo
sudo chmod a+x /usr/local/bin/repo
pip3 install -i https://repo.huaweicloud.com/repository/pypi/simple requests
5、对git进行全局配置，配置账号和选项并进行测试
// 配置git，以abc@163.com为例，实际配置以注册账号为准   git config --global user.name "abc"   git config --global user.email "abc@163.com"   git config --global credential.helper store
// 测试   ssh -T git@gitee.com'><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://loonguser.github.io/system/build_openharmony_for_2k500/"><meta property="og:site_name" content="龙芯玩机指南"><meta property="og:title" content="龙芯2K500先锋派OpenHarmony构建指北"><meta property="og:description" content=' 文章来源: https://bbs.loongarch.org/d/435-2k500openharmony
一、系统需求和环境配置 # 官方推荐系统是ubuntu 20.4，预留60G到80G的磁盘空间，交换分区推荐8G以上，主要环境是python3.9。 也可以使用Debian构建，留意python版本，python3.10及更新版本要改一行代码，才能正常运行hb构建工具。
需要安装的软件包：
sudo apt update sudo apt upgrade sudo apt install apt-utils binutils bison flex bc build-essential make mtd-utils gcc-arm-linux-gnueabi u-boot-tools python3.9 python3-pip git zip unzip curl wget gcc g++ ruby dosfstools mtools default-jre default-jdk scons python3-distutils perl openssl libssl-dev cpio git-lfs m4 ccache zlib1g-dev tar rsync liblz4-tool genext2fs binutils-dev device-tree-compiler e2fsprogs git-core gnupg gnutls-bin gperf lib32ncurses5-dev libffi-dev zlib* libelf-dev libx11-dev libgl1-mesa-dev lib32z1-dev xsltproc x11proto-core-dev libc6-dev-i386 libxml2-dev lib32z-dev libdwarf-dev grsync xxd libglib2.0-dev libpixman-1-dev kmod jfsutils reiserfsprogs xfsprogs squashfs-tools pcmciautils quota ppp libtinfo-dev libtinfo5 libncurses5 libncurses5-dev libncursesw5 libstdc++6 gcc-arm-none-eabi vim ssh locales doxygen libxinerama-dev libxcursor-dev libxrandr-dev libxi-dev npm libfl-dev 二、注册gitee账号和代码下载前的准备 # 源码下载推荐使用gitee的repo工具，从OpenHarmony gitee仓库下载代码，也可以使用OpenHarmony全量代码包。 参见资源链接1。使用repo工具需要gitee账号，并上传ssh公钥到账号的"ssh配置”里面，并且需要对git进行全局配置。大致过程如下：
1、使用电子邮箱注册gitee账号，如 abc@163.com 2、使用如下命令建立公钥 ssh-keygen -t ed25519 -C "Gitee SSH Key" 3、获取公钥内容并复制到gitee的ssh配置里面 cat ~/.ssh/id_ed25519.pub 4、获取gitee repo工具并赋予可执行权限 sudo curl -s https://gitee.com/oschina/repo/raw/fork_flow/repo-py3 > /usr/local/bin/repo sudo chmod a+x /usr/local/bin/repo pip3 install -i https://repo.huaweicloud.com/repository/pypi/simple requests 5、对git进行全局配置，配置账号和选项并进行测试 // 配置git，以abc@163.com为例，实际配置以注册账号为准 git config --global user.name "abc" git config --global user.email "abc@163.com" git config --global credential.helper store // 测试 ssh -T git@gitee.com'><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="article:section" content="system"><meta property="article:modified_time" content="2024-07-12T18:01:58+08:00"><title>龙芯2K500先锋派OpenHarmony构建指北 | 龙芯玩机指南</title>
<link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png><link rel=canonical href=https://loonguser.github.io/system/build_openharmony_for_2k500/><link rel=stylesheet href=/book.min.ddac3efe7ea4c1007ff53e5a8fd67f12517e5d2e99984d8c67a18668f7ecaa03.css integrity="sha256-3aw+/n6kwQB/9T5aj9Z/ElF+XS6ZmE2MZ6GGaPfsqgM=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/zh.search.min.03d02d3602d9c720722d657cf8e5b5510f7844ccec3e0149a7c94c612e403e81.js integrity="sha256-A9AtNgLZxyByLWV8+OW1UQ94RMzsPgFJp8lMYS5APoE=" crossorigin=anonymous></script><script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>龙芯玩机指南</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=搜索 aria-label=搜索 maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul class=book-languages><li><input type=checkbox id=languages class=toggle>
<label for=languages class="flex justify-between"><a role=button class="flex align-center"><img src=/svg/translate.svg class=book-icon alt=Languages>
Chinese</a></label><ul><li><a href=https://loonguser.github.io/en/>English</a></li><li><a href=https://loonguser.github.io/ru/>Russian</a></li></ul></li></ul><ul><li><a href=/firmware/>Firmware</a><ul><li><a href=/firmware/grub/>Grub编译与调试</a></li><li><a href=/firmware/pmon/>PMON的使用方法</a></li><li><a href=/firmware/uefi_boot_system/>从UEFI如何启动到系统</a></li><li><a href=/firmware/uefi/>龙芯UEFI使用详解</a></li><li><a href=/firmware/firmware/>如何更新固件</a></li></ul></li><li><span>Applications</span><ul><li><a href=/applications/gogs/>3A6000上搭建gogs</a></li><li><a href=/applications/blog/>3A6000上搭建hexo博客</a></li><li><a href=/applications/qemu/>Qemu使用</a></li><li><a href=/applications/ejtag/>龙芯lajtag常用技巧</a></li><li><a href=/applications/clash/>龙芯平台使用clash</a></li><li><a href=/applications/lat/>在龙芯3A5000上运行Windows程序</a></li></ul></li><li><span>Systems</span><ul><li><a href=/system/Loongnix_FAQ/>Loongnix_FAQ</a></li><li><a href=/system/build_openharmony_for_2k500/ class=active>龙芯2K500先锋派OpenHarmony构建指北</a></li><li><a href=/system/boot_param_with_kernel/>龙芯系统启动参数</a></li><li><a href=/system/kernel/>内核编译</a></li><li><a href=/system/update_system/>如何更新系统</a></li><li><a href=/system/gen_sys_file/>生成系统下的一些文件</a></li><li><a href=/system/systeminfo/>系统下查看一些信息</a></li><li><a href=/system/install_archlinux/>新世界Archlinux系统安装</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu>
</label><strong>龙芯2K500先锋派OpenHarmony构建指北</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li><ul><li><a href=#一系统需求和环境配置>一、系统需求和环境配置</a></li><li><a href=#二注册gitee账号和代码下载前的准备>二、注册gitee账号和代码下载前的准备</a></li><li><a href=#三开放鸿蒙代码下载和环境配置>三、开放鸿蒙代码下载和环境配置</a></li><li><a href=#四应用龙芯2k500先锋派相关补丁和工具链>四、应用龙芯2K500先锋派相关补丁和工具链</a></li><li><a href=#五构建环境配置和编译>五、构建环境配置和编译</a></li><li><a href=#六相关资源链接>六、相关资源链接</a></li><li><a href=#七补充资源>七、补充资源</a></li></ul></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><blockquote><p>文章来源: <code>https://bbs.loongarch.org/d/435-2k500openharmony</code></p></blockquote><h3 id=一系统需求和环境配置>一、系统需求和环境配置
<a class=anchor href=#%e4%b8%80%e7%b3%bb%e7%bb%9f%e9%9c%80%e6%b1%82%e5%92%8c%e7%8e%af%e5%a2%83%e9%85%8d%e7%bd%ae>#</a></h3><p>官方推荐系统是ubuntu 20.4，预留60G到80G的磁盘空间，交换分区推荐8G以上，主要环境是python3.9。
也可以使用Debian构建，留意python版本，python3.10及更新版本要改一行代码，才能正常运行hb构建工具。</p><p>需要安装的软件包：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scss data-lang=scss><span style=display:flex><span><span style=color:#f92672>sudo</span> <span style=color:#f92672>apt</span> <span style=color:#f92672>update</span>
</span></span><span style=display:flex><span><span style=color:#f92672>sudo</span> <span style=color:#f92672>apt</span> <span style=color:#f92672>upgrade</span>
</span></span><span style=display:flex><span><span style=color:#f92672>sudo</span> <span style=color:#f92672>apt</span> <span style=color:#f92672>install</span>   <span style=color:#f92672>apt-utils</span> <span style=color:#f92672>binutils</span> <span style=color:#f92672>bison</span> <span style=color:#f92672>flex</span> <span style=color:#f92672>bc</span> <span style=color:#f92672>build-essential</span> <span style=color:#f92672>make</span> <span style=color:#f92672>mtd-utils</span> <span style=color:#f92672>gcc-arm-linux-gnueabi</span> <span style=color:#f92672>u-boot-tools</span> <span style=color:#f92672>python3</span><span style=color:#a6e22e>.9</span> <span style=color:#f92672>python3-pip</span> <span style=color:#f92672>git</span> <span style=color:#f92672>zip</span> <span style=color:#f92672>unzip</span> <span style=color:#f92672>curl</span> <span style=color:#f92672>wget</span> <span style=color:#f92672>gcc</span> <span style=color:#f92672>g</span><span style=color:#f92672>++</span> <span style=color:#f92672>ruby</span> <span style=color:#f92672>dosfstools</span> <span style=color:#f92672>mtools</span> <span style=color:#f92672>default-jre</span> <span style=color:#f92672>default-jdk</span> <span style=color:#f92672>scons</span> <span style=color:#f92672>python3-distutils</span> <span style=color:#f92672>perl</span> <span style=color:#f92672>openssl</span> <span style=color:#f92672>libssl-dev</span> <span style=color:#f92672>cpio</span> <span style=color:#f92672>git-lfs</span> <span style=color:#f92672>m4</span> <span style=color:#f92672>ccache</span> <span style=color:#f92672>zlib1g-dev</span> <span style=color:#f92672>tar</span> <span style=color:#f92672>rsync</span> <span style=color:#f92672>liblz4-tool</span> <span style=color:#f92672>genext2fs</span> <span style=color:#f92672>binutils-dev</span> <span style=color:#f92672>device-tree-compiler</span> <span style=color:#f92672>e2fsprogs</span> <span style=color:#f92672>git-core</span> <span style=color:#f92672>gnupg</span> <span style=color:#f92672>gnutls-bin</span> <span style=color:#f92672>gperf</span> <span style=color:#f92672>lib32ncurses5-dev</span> <span style=color:#f92672>libffi-dev</span> <span style=color:#f92672>zlib</span><span style=color:#f92672>*</span> <span style=color:#f92672>libelf-dev</span> <span style=color:#f92672>libx11-dev</span> <span style=color:#f92672>libgl1-mesa-dev</span> <span style=color:#f92672>lib32z1-dev</span> <span style=color:#f92672>xsltproc</span> <span style=color:#f92672>x11proto-core-dev</span> <span style=color:#f92672>libc6-dev-i386</span> <span style=color:#f92672>libxml2-dev</span> <span style=color:#f92672>lib32z-dev</span> <span style=color:#f92672>libdwarf-dev</span> <span style=color:#f92672>grsync</span> <span style=color:#f92672>xxd</span> <span style=color:#f92672>libglib2</span><span style=color:#a6e22e>.0-dev</span> <span style=color:#f92672>libpixman-1-dev</span> <span style=color:#f92672>kmod</span> <span style=color:#f92672>jfsutils</span> <span style=color:#f92672>reiserfsprogs</span> <span style=color:#f92672>xfsprogs</span> <span style=color:#f92672>squashfs-tools</span>  <span style=color:#f92672>pcmciautils</span> <span style=color:#f92672>quota</span> <span style=color:#f92672>ppp</span> <span style=color:#f92672>libtinfo-dev</span> <span style=color:#f92672>libtinfo5</span> <span style=color:#f92672>libncurses5</span> <span style=color:#f92672>libncurses5-dev</span> <span style=color:#f92672>libncursesw5</span> <span style=color:#f92672>libstdc</span><span style=color:#f92672>++</span><span style=color:#f92672>6</span>  <span style=color:#f92672>gcc-arm-none-eabi</span> <span style=color:#f92672>vim</span> <span style=color:#f92672>ssh</span> <span style=color:#f92672>locales</span> <span style=color:#f92672>doxygen</span> <span style=color:#f92672>libxinerama-dev</span> <span style=color:#f92672>libxcursor-dev</span> <span style=color:#f92672>libxrandr-dev</span> <span style=color:#f92672>libxi-dev</span> <span style=color:#f92672>npm</span> <span style=color:#f92672>libfl-dev</span>
</span></span></code></pre></div><h3 id=二注册gitee账号和代码下载前的准备>二、注册gitee账号和代码下载前的准备
<a class=anchor href=#%e4%ba%8c%e6%b3%a8%e5%86%8cgitee%e8%b4%a6%e5%8f%b7%e5%92%8c%e4%bb%a3%e7%a0%81%e4%b8%8b%e8%bd%bd%e5%89%8d%e7%9a%84%e5%87%86%e5%a4%87>#</a></h3><p>源码下载推荐使用gitee的repo工具，从OpenHarmony gitee仓库下载代码，也可以使用OpenHarmony全量代码包。
参见资源链接1。使用repo工具需要gitee账号，并上传ssh公钥到账号的"ssh配置”里面，并且需要对git进行全局配置。大致过程如下：</p><p>1、使用电子邮箱注册gitee账号，如
<a href=mailto:abc@163.com>abc@163.com</a>
2、使用如下命令建立公钥
<code>ssh-keygen -t ed25519 -C "Gitee SSH Key"</code>
3、获取公钥内容并复制到gitee的ssh配置里面
<code>cat ~/.ssh/id_ed25519.pub</code>
4、获取gitee repo工具并赋予可执行权限
<code>sudo curl -s https://gitee.com/oschina/repo/raw/fork_flow/repo-py3 > /usr/local/bin/repo</code>
<code>sudo chmod a+x /usr/local/bin/repo</code>
<code>pip3 install -i https://repo.huaweicloud.com/repository/pypi/simple requests</code>
5、对git进行全局配置，配置账号和选项并进行测试
<code>// 配置git，以abc@163.com为例，实际配置以注册账号为准 git config --global user.name "abc" git config --global user.email "abc@163.com" git config --global credential.helper store</code>
<code>// 测试 ssh -T git@gitee.com</code></p><h3 id=三开放鸿蒙代码下载和环境配置>三、开放鸿蒙代码下载和环境配置
<a class=anchor href=#%e4%b8%89%e5%bc%80%e6%94%be%e9%b8%bf%e8%92%99%e4%bb%a3%e7%a0%81%e4%b8%8b%e8%bd%bd%e5%92%8c%e7%8e%af%e5%a2%83%e9%85%8d%e7%bd%ae>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// 建立 OpenHarmony 目录
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>mkdir oh41
</span></span><span style=display:flex><span>cd oh41
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 初始化
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>repo <span style=color:#66d9ef>init</span> -u git<span style=color:#a6e22e>@gitee</span>.com:openharmony/manifest.git -b refs/tags/OpenHarmony-v4.<span style=color:#ae81ff>1</span>-Release <span style=color:#f92672>--</span>no-repo-verify
</span></span><span style=display:flex><span><span style=color:#75715e>// 获取源码
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>repo sync -c -j4
</span></span><span style=display:flex><span><span style=color:#75715e>// 获取大文件
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>repo forall -c <span style=color:#960050;background-color:#1e0010>&#39;</span>git lfs pull<span style=color:#960050;background-color:#1e0010>&#39;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 获取预编译工具链
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>./build/prebuilts_download.sh
</span></span><span style=display:flex><span><span style=color:#75715e>// 安装hb
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>pip3 install build/hb
</span></span><span style=display:flex><span><span style=color:#75715e>// 环境测试，如下命令会输出hb的命令行帮助信息
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>hb help
</span></span></code></pre></div><h3 id=四应用龙芯2k500先锋派相关补丁和工具链>四、应用龙芯2K500先锋派相关补丁和工具链
<a class=anchor href=#%e5%9b%9b%e5%ba%94%e7%94%a8%e9%be%99%e8%8a%af2k500%e5%85%88%e9%94%8b%e6%b4%be%e7%9b%b8%e5%85%b3%e8%a1%a5%e4%b8%81%e5%92%8c%e5%b7%a5%e5%85%b7%e9%93%be>#</a></h3><p>1、系统适配龙芯部分</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// 这部分是2K500先锋派适配代码，处于开发状态，建议进行动态跟踪并变通使用
</span></span></span><span style=display:flex><span><span style=color:#75715e>// dayu400是hihope适配2K500先锋派的内部代号，需要在vendor和device中都有相关的配置
</span></span></span><span style=display:flex><span><span style=color:#75715e>// vendor/hihope/dayu400 对应 hb set 里面的产品列表，定义的内容主要是“架构”和“功能”的定义
</span></span></span><span style=display:flex><span><span style=color:#75715e>// device/board/hihope/dayu400 目录下包括适配OpenHarmony的各种补丁、构建参数的相关定义
</span></span></span><span style=display:flex><span><span style=color:#75715e>// device/board/soc/loongson 目录下是LoongArch架构相关代码和定义
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>cd</span> <span style=color:#a6e22e>vendor</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>rm</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>rf</span> <span style=color:#a6e22e>hihope</span>  <span style=color:#75715e># 删除 OpenHarmony-v4.1-Release 基础代码中的 vendor/hihope 仓库
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>git</span> <span style=color:#66d9ef>clone</span> <span style=color:#a6e22e>https</span><span style=color:#f92672>://</span><span style=color:#a6e22e>gitee</span><span style=color:#f92672>.</span><span style=color:#a6e22e>com</span><span style=color:#f92672>/</span><span style=color:#a6e22e>openharmony</span><span style=color:#f92672>-</span><span style=color:#a6e22e>sig</span><span style=color:#f92672>/</span><span style=color:#a6e22e>vendor_hihope</span><span style=color:#f92672>.</span><span style=color:#a6e22e>git</span> <span style=color:#a6e22e>hihope</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 变通部分
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>cd</span> <span style=color:#a6e22e>hihope</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>git</span> <span style=color:#a6e22e>checkout</span> <span style=color:#a6e22e>切换至</span> <span style=color:#a6e22e>OpenHarmony</span><span style=color:#f92672>-</span><span style=color:#ae81ff>4.1</span><span style=color:#f92672>-</span><span style=color:#a6e22e>Release</span> <span style=color:#a6e22e>分支</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>cd</span> <span style=color:#a6e22e>device</span><span style=color:#f92672>/</span><span style=color:#a6e22e>board</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>rm</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>rf</span> <span style=color:#a6e22e>hihope</span>  <span style=color:#75715e># 删除 OpenHarmony-v4.1-Release 基础代码中的 device/board/hihope 仓库
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>git</span> <span style=color:#66d9ef>clone</span> <span style=color:#a6e22e>https</span><span style=color:#f92672>://</span><span style=color:#a6e22e>gitee</span><span style=color:#f92672>.</span><span style=color:#a6e22e>com</span><span style=color:#f92672>/</span><span style=color:#a6e22e>openharmony</span><span style=color:#f92672>-</span><span style=color:#a6e22e>sig</span><span style=color:#f92672>/</span><span style=color:#a6e22e>device_board_hihope</span> <span style=color:#a6e22e>hihope</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 变通部分
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>cd</span> <span style=color:#a6e22e>hihope</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>复制dayu210目录到临时目录</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>git</span> <span style=color:#a6e22e>checkout</span> <span style=color:#a6e22e>切换至</span> <span style=color:#a6e22e>OpenHarmony</span><span style=color:#f92672>-</span><span style=color:#ae81ff>4.1</span><span style=color:#f92672>-</span><span style=color:#a6e22e>Release</span> <span style=color:#a6e22e>分支</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>粘贴dayu210目录到</span> <span style=color:#a6e22e>hihope</span> <span style=color:#a6e22e>目录下</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd device/soc
</span></span><span style=display:flex><span><span style=color:#75715e># OpenHarmony-v4.1-Release 基础代码中没有 loongson 仓库</span>
</span></span><span style=display:flex><span>git clone https://gitee.com/ohos4la-l1/device_soc_loongson loongson
</span></span></code></pre></div><p>2、内核部分
获取 5.10.97 版本的Linux内核代码（v4.1-Release的内核为 5.10.184版本，当前的内核补丁尚无法完美打入，暂先使用3.2-Release的5.10.97 版本的内核）</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#f92672>//</span> <span style=color:#960050;background-color:#1e0010>回到</span> openharmony <span style=color:#960050;background-color:#1e0010>代码根目录</span>
</span></span><span style=display:flex><span>cd kernel<span style=color:#f92672>/</span>linux<span style=color:#f92672>/</span>
</span></span><span style=display:flex><span>cp <span style=color:#f92672>-</span>r linux<span style=color:#f92672>-</span><span style=color:#ae81ff>5</span>.<span style=color:#ae81ff>10</span> linux<span style=color:#f92672>-</span><span style=color:#ae81ff>5</span>.<span style=color:#ae81ff>10</span>.<span style=color:#ae81ff>97</span>
</span></span><span style=display:flex><span>cd linux<span style=color:#f92672>-</span><span style=color:#ae81ff>5</span>.<span style=color:#ae81ff>10</span>.<span style=color:#ae81ff>97</span>
</span></span><span style=display:flex><span>git <span style=color:#66d9ef>fetch</span> origin OpenHarmony<span style=color:#f92672>-</span><span style=color:#ae81ff>3</span>.<span style=color:#ae81ff>2</span><span style=color:#f92672>-</span>Release:OpenHarmony<span style=color:#f92672>-</span><span style=color:#ae81ff>3</span>.<span style=color:#ae81ff>2</span><span style=color:#f92672>-</span>Release
</span></span><span style=display:flex><span>git switch OpenHarmony<span style=color:#f92672>-</span><span style=color:#ae81ff>3</span>.<span style=color:#ae81ff>2</span><span style=color:#f92672>-</span>Release
</span></span></code></pre></div><p>3、导入补丁集</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#75715e>// 回到openharmony 代码根目录
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 变通部分
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 拷贝device/board/hihope/dayu400/patches 到 device/soc/loongson/ 目录
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 修改 device/board/hihope/dayu400/patch.sh
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>cd device<span style=color:#f92672>/</span>board<span style=color:#f92672>/</span>hihope<span style=color:#f92672>/</span>dayu400
</span></span><span style=display:flex><span>.<span style=color:#f92672>/</span>patch.sh
</span></span></code></pre></div><p>4、工具链安装和配置</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// 回到openharmony 代码根目录
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 下载
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>git</span> <span style=color:#66d9ef>clone</span> <span style=color:#a6e22e>https</span><span style=color:#f92672>://</span><span style=color:#a6e22e>gitee</span><span style=color:#f92672>.</span><span style=color:#a6e22e>com</span><span style=color:#f92672>/</span><span style=color:#a6e22e>loongarch_community</span><span style=color:#f92672>/</span><span style=color:#a6e22e>loongarch64</span><span style=color:#f92672>-</span><span style=color:#a6e22e>linux</span><span style=color:#f92672>-</span><span style=color:#a6e22e>gnu</span><span style=color:#f92672>.</span><span style=color:#a6e22e>git</span> <span style=color:#a6e22e>toolchain</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 建立目录
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>mkdir</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>p</span> <span style=color:#a6e22e>prebuilts</span><span style=color:#f92672>/</span><span style=color:#a6e22e>gcc</span><span style=color:#f92672>/</span><span style=color:#a6e22e>linux</span><span style=color:#f92672>-</span><span style=color:#a6e22e>x86</span><span style=color:#f92672>/</span><span style=color:#a6e22e>loongarch</span><span style=color:#f92672>/</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 解压
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>tar</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>C</span> <span style=color:#a6e22e>prebuilts</span><span style=color:#f92672>/</span><span style=color:#a6e22e>gcc</span><span style=color:#f92672>/</span><span style=color:#a6e22e>linux</span><span style=color:#f92672>-</span><span style=color:#a6e22e>x86</span><span style=color:#f92672>/</span><span style=color:#a6e22e>loongarch</span><span style=color:#f92672>/</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>xvf</span> <span style=color:#a6e22e>toolchain</span><span style=color:#f92672>/</span><span style=color:#a6e22e>toolchain</span><span style=color:#f92672>-</span><span style=color:#a6e22e>loongarch64</span><span style=color:#f92672>-</span><span style=color:#a6e22e>linux</span><span style=color:#f92672>-</span><span style=color:#a6e22e>gnu</span><span style=color:#f92672>-</span><span style=color:#a6e22e>gcc8</span><span style=color:#f92672>-</span><span style=color:#a6e22e>host</span><span style=color:#f92672>-</span><span style=color:#a6e22e>x86_64</span><span style=color:#f92672>-</span><span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>07</span><span style=color:#f92672>-</span><span style=color:#ae81ff>18.</span><span style=color:#a6e22e>tar</span><span style=color:#f92672>.</span><span style=color:#a6e22e>xz</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 重命名，符合dayu400交叉编译工具链配置
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>mv</span> <span style=color:#a6e22e>prebuilts</span><span style=color:#f92672>/</span><span style=color:#a6e22e>gcc</span><span style=color:#f92672>/</span><span style=color:#a6e22e>linux</span><span style=color:#f92672>-</span><span style=color:#a6e22e>x86</span><span style=color:#f92672>/</span><span style=color:#a6e22e>loongarch</span><span style=color:#f92672>/</span><span style=color:#a6e22e>toolchain</span><span style=color:#f92672>-</span><span style=color:#a6e22e>loongarch64</span><span style=color:#f92672>-</span><span style=color:#a6e22e>linux</span><span style=color:#f92672>-</span><span style=color:#a6e22e>gnu</span><span style=color:#f92672>-</span><span style=color:#a6e22e>gcc8</span><span style=color:#f92672>-</span><span style=color:#a6e22e>host</span><span style=color:#f92672>-</span><span style=color:#a6e22e>x86_64</span><span style=color:#f92672>-</span><span style=color:#ae81ff>2022</span><span style=color:#f92672>-</span><span style=color:#ae81ff>07</span><span style=color:#f92672>-</span><span style=color:#ae81ff>18</span> <span style=color:#a6e22e>prebuilts</span><span style=color:#f92672>/</span><span style=color:#a6e22e>gcc</span><span style=color:#f92672>/</span><span style=color:#a6e22e>linux</span><span style=color:#f92672>-</span><span style=color:#a6e22e>x86</span><span style=color:#f92672>/</span><span style=color:#a6e22e>loongarch</span><span style=color:#f92672>/</span><span style=color:#a6e22e>loongarch64</span><span style=color:#f92672>-</span><span style=color:#a6e22e>linux</span><span style=color:#f92672>-</span><span style=color:#a6e22e>gnu</span><span style=color:#f92672>/</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 标准库的临时变通使用
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>cp</span> <span style=color:#a6e22e>prebuilts</span><span style=color:#f92672>/</span><span style=color:#a6e22e>gcc</span><span style=color:#f92672>/</span><span style=color:#a6e22e>linux</span><span style=color:#f92672>-</span><span style=color:#a6e22e>x86</span><span style=color:#f92672>/</span><span style=color:#a6e22e>loongarch</span><span style=color:#f92672>/</span><span style=color:#a6e22e>loongarch64</span><span style=color:#f92672>-</span><span style=color:#a6e22e>linux</span><span style=color:#f92672>-</span><span style=color:#a6e22e>gnu</span><span style=color:#f92672>/</span><span style=color:#a6e22e>sysroot</span><span style=color:#f92672>/</span><span style=color:#a6e22e>usr</span><span style=color:#f92672>/</span><span style=color:#a6e22e>lib64</span><span style=color:#f92672>/</span><span style=color:#a6e22e>libstdc</span><span style=color:#f92672>++.</span><span style=color:#a6e22e>so</span> <span style=color:#a6e22e>prebuilts</span><span style=color:#f92672>/</span><span style=color:#a6e22e>gcc</span><span style=color:#f92672>/</span><span style=color:#a6e22e>linux</span><span style=color:#f92672>-</span><span style=color:#a6e22e>x86</span><span style=color:#f92672>/</span><span style=color:#a6e22e>loongarch</span><span style=color:#f92672>/</span><span style=color:#a6e22e>loongarch64</span><span style=color:#f92672>-</span><span style=color:#a6e22e>linux</span><span style=color:#f92672>-</span><span style=color:#a6e22e>gnu</span><span style=color:#f92672>/</span><span style=color:#a6e22e>sysroot</span><span style=color:#f92672>/</span><span style=color:#a6e22e>usr</span><span style=color:#f92672>/</span><span style=color:#a6e22e>lib64</span><span style=color:#f92672>/</span><span style=color:#a6e22e>libc</span><span style=color:#f92672>++.</span><span style=color:#a6e22e>so</span>
</span></span></code></pre></div><h3 id=五构建环境配置和编译>五、构建环境配置和编译
<a class=anchor href=#%e4%ba%94%e6%9e%84%e5%bb%ba%e7%8e%af%e5%a2%83%e9%85%8d%e7%bd%ae%e5%92%8c%e7%bc%96%e8%af%91>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#75715e>// 回到 openharmony 目录
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>hb set
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>选择</span> small -&gt; <span style=color:#a6e22e>hihope</span> -&gt; <span style=color:#a6e22e>dayu400</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 如果没有报错信息，表示前述配置基本正确
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>hb build
</span></span><span style=display:flex><span><span style=color:#75715e>// 所有构建都存放在 out 目录下
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 若遇到报错，可删除out目录，重新运行 set &amp; build
</span></span></span></code></pre></div><h3 id=六相关资源链接>六、相关资源链接
<a class=anchor href=#%e5%85%ad%e7%9b%b8%e5%85%b3%e8%b5%84%e6%ba%90%e9%93%be%e6%8e%a5>#</a></h3><ul><li><a href=https://gitee.com/openharmony/docs/blob/master/zh-cn/release-notes/OpenHarmony-v4.1-release.md>https://gitee.com/openharmony/docs/blob/master/zh-cn/release-notes/OpenHarmony-v4.1-release.md</a></li><li><a href=https://gitee.com/openharmony-sig/device_board_hihope/tree/OpenHarmony-4.1-Release/dayu400>https://gitee.com/openharmony-sig/device_board_hihope/tree/OpenHarmony-4.1-Release/dayu400</a></li><li><a href=https://gitee.com/openharmony-sig/device_board_hihope/blob/OpenHarmony-4.1-Release/dayu400/LS2K0500-DevGuide.md>https://gitee.com/openharmony-sig/device_board_hihope/blob/OpenHarmony-4.1-Release/dayu400/LS2K0500-DevGuide.md</a></li><li><a href=http://docs.openharmony.cn/pages/v4.1/zh-cn/device-dev/subsystems/subsys-build-all.md>http://docs.openharmony.cn/pages/v4.1/zh-cn/device-dev/subsystems/subsys-build-all.md</a></li></ul><h3 id=七补充资源>七、补充资源
<a class=anchor href=#%e4%b8%83%e8%a1%a5%e5%85%85%e8%b5%84%e6%ba%90>#</a></h3><p>构建内核所需的支持LoongArch架构的mkimage，是个u-boot工具程序</p><p><a href=https://bbs.loongarch.org/d/435-2k500openharmony>mkimage.zip</a></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/LoongUser/loonguser.github.io/commit/fb667f5a50b64c1974f9be4aebacf7c3f08a046c title='最后修改者 AydenMeng | 七月 12, 2024' target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt>
<span>七月 12, 2024</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li><ul><li><a href=#一系统需求和环境配置>一、系统需求和环境配置</a></li><li><a href=#二注册gitee账号和代码下载前的准备>二、注册gitee账号和代码下载前的准备</a></li><li><a href=#三开放鸿蒙代码下载和环境配置>三、开放鸿蒙代码下载和环境配置</a></li><li><a href=#四应用龙芯2k500先锋派相关补丁和工具链>四、应用龙芯2K500先锋派相关补丁和工具链</a></li><li><a href=#五构建环境配置和编译>五、构建环境配置和编译</a></li><li><a href=#六相关资源链接>六、相关资源链接</a></li><li><a href=#七补充资源>七、补充资源</a></li></ul></li></ul></li></ul></nav></div></aside></main></body></html>